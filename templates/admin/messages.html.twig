{% extends 'admin/base.html.twig' %}

{% block title %}Contact Messages - Admin{% endblock %}

{% block admin_body %}
<div class="container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h1 class="section-title" style="margin: 0;">Contact Messages</h1>
        <a href="{{ path('admin_dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
    </div>

    {% if messages|length > 0 %}
    <div class="table">
        <table>
            <thead>
                <tr>
                    <th>Status</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Message</th>
                    <th>Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for message in messages %}
                <tr style="{{ message.isRead ? '' : 'background: rgba(255, 193, 7, 0.15); border-left: 4px solid #ffc107;' }}">
                    <td>
                        {% if message.isRead %}
                            <span style="color: var(--text-muted);">✓ Read</span>
                        {% else %}
                            <span style="color: #ffc107; font-weight: 700; background: rgba(255, 193, 7, 0.2); padding: 0.3rem 0.6rem; border-radius: 4px;">● New</span>
                        {% endif %}
                    </td>
                    <td><strong>{{ message.name }}</strong></td>
                    <td>{{ message.email }}</td>
                    <td style="max-width: 400px;">
                        <div style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                            {{ message.message|slice(0, 100) }}{% if message.message|length > 100 %}...{% endif %}
                        </div>
                    </td>
                    <td>{{ message.createdAt|date('M d, Y H:i') }}</td>
                    <td>
                        <div style="display: flex; gap: 0.5rem;">
                            <button type="button" onclick="showMessage({{ message.id }}, '{{ message.name|e('js') }}', '{{ message.email|e('js') }}', '{{ message.message|e('js') }}', '{{ message.createdAt|date('M d, Y H:i') }}')" class="btn" style="padding: 0.5rem 1rem; font-size: 0.9rem;">View</button>
                            {% if not message.isRead %}
                            <form method="post" action="{{ path('admin_message_read', {id: message.id}) }}" style="display: inline-block;">
                                <input type="hidden" name="_token" value="{{ csrf_token('read' ~ message.id) }}">
                                <button type="submit" class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.9rem;">Mark Read</button>
                            </form>
                            {% endif %}
                            <form method="post" action="{{ path('admin_message_delete', {id: message.id}) }}" style="display: inline-block;" onsubmit="return confirm('Are you sure you want to delete this message?');">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ message.id) }}">
                                <button type="submit" class="btn btn-danger" style="padding: 0.5rem 1rem; font-size: 0.9rem;">Delete</button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div style="text-align: center; padding: 3rem;">
        <p style="color: var(--text-secondary);">No messages found.</p>
    </div>
    {% endif %}
</div>

<!-- Modal for viewing full message -->
<div id="messageModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 2000; align-items: center; justify-content: center;">
    <div style="background: var(--bg-secondary); padding: 2rem; border-radius: 4px; max-width: 600px; width: 90%; border: 1px solid var(--border-color);">
        <h2 id="modalName" style="margin-bottom: 1rem; color: var(--text-primary);"></h2>
        <p style="color: var(--text-secondary); margin-bottom: 0.5rem;"><strong>Email:</strong> <span id="modalEmail"></span></p>
        <p style="color: var(--text-secondary); margin-bottom: 1rem;"><strong>Date:</strong> <span id="modalDate"></span></p>
        <div style="background: var(--bg-tertiary); padding: 1.5rem; border-radius: 4px; margin-bottom: 1.5rem;">
            <p id="modalMessage" style="color: var(--text-primary); line-height: 1.6; white-space: pre-wrap;"></p>
        </div>
        <button onclick="closeMessage()" class="btn" style="width: 100%;">Close</button>
    </div>
</div>

<script>
function showMessage(id, name, email, message, date) {
    document.getElementById('modalName').textContent = name;
    document.getElementById('modalEmail').textContent = email;
    document.getElementById('modalDate').textContent = date;
    document.getElementById('modalMessage').textContent = message;
    document.getElementById('messageModal').style.display = 'flex';
}

function closeMessage() {
    document.getElementById('messageModal').style.display = 'none';
}

// Close modal on outside click
document.getElementById('messageModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeMessage();
    }
});
</script>
{% endblock %}

